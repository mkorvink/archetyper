<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2021-03-15" />

<title>Introduction to archetyper</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to archetyper</h1>
<h4 class="date">2021-03-15</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(archetyper)</span></code></pre></div>
<p>‘archetyper’ initializes data mining and data science projects by generating common workflow components as well as peripheral files needed to support technical best practices:</p>
<p>The lifecyle of a data mining project generally includes the following components:</p>
<ul>
<li><p>Integration</p></li>
<li><p>Exploration</p></li>
<li><p>Enrichment</p></li>
<li><p>Modeling</p></li>
<li><p>Evaluation</p></li>
<li><p>Presentation</p></li>
<li><p>Deployment</p></li>
</ul>
<p>Additionally, a well-formed data mining project will include:</p>
<ul>
<li><p>Centralized code for common libraries, functions, and constants</p></li>
<li><p>Version control (e.g. git)</p></li>
<li><p>Unit testing</p></li>
<li><p>A readme file</p></li>
<li><p>Adherence to syntax and style</p></li>
<li><p>Externalized properties for secret information (when necessary)</p></li>
<li><p>Logging</p></li>
<li><p>Use of relative directories</p></li>
</ul>
<div id="generating-a-new-project-with-generate" class="section level2">
<h2>Generating a new project with generate():</h2>
<p>generate will create a new project with the files and directories to support the data mining and data science workflow.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">generate</span>(<span class="st">&quot;majestic_12&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">list.files</span>(<span class="st">&quot;majestic_12&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4"></a>[<span class="dv">1</span>] <span class="st">&quot;data_input&quot;</span>        <span class="st">&quot;data_output&quot;</span>       <span class="st">&quot;data_working&quot;</span>      <span class="st">&quot;docs&quot;</span>              <span class="st">&quot;majestic_12.Rproj&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>[<span class="dv">6</span>] <span class="st">&quot;models&quot;</span>            <span class="st">&quot;R&quot;</span>                 <span class="st">&quot;readme.md&quot;</span>      <span class="st">&quot;.gitignore&quot;</span>        </span></code></pre></div>
<p>The R code for the data workflow will be in the R/ directory.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">list.files</span>(<span class="st">&quot;majestic_12/R/&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a> [<span class="dv">1</span>] <span class="st">&quot;0_test.R&quot;</span>      <span class="st">&quot;1_integrate.R&quot;</span> <span class="st">&quot;2_enrich.R&quot;</span>    <span class="st">&quot;3_model.R&quot;</span>    </span>
<span id="cb3-4"><a href="#cb3-4"></a> [<span class="dv">5</span>] <span class="st">&quot;4_evaluate.R&quot;</span>  <span class="st">&quot;5_present.Rmd&quot;</span> <span class="st">&quot;api.R&quot;</span>         <span class="st">&quot;common.R&quot;</span>     </span>
<span id="cb3-5"><a href="#cb3-5"></a> [<span class="dv">9</span>] <span class="st">&quot;explore.R&quot;</span>     <span class="st">&quot;lint.R&quot;</span>        <span class="st">&quot;mediator.R&quot;</span>    <span class="st">&quot;utilities.R&quot;</span>  </span></code></pre></div>
<p>The base work-flow files include integrate.R, enrich.R, model.R, evaluate.R, present.Rmd, and api.R.</p>
<ul>
<li><code>1_integrate.R</code> is responsible for acquiring and integrating data across data sources as well as standardizing data types and naming conventions of columnar data. It is recommended that the output of the integration step is prepared as a two-by-two tibble, with rows as observations and columns as raw candidate features. The output should be saved in version-controlled feather format to the <code>data_working/</code> directory for downstream use.</li>
<li><code>2_enrich.R</code> is responsible for reading integrated data from the <code>data_working/</code> directory and enriching the raw features into more informative features specific to the model being applied. Tasks in this stage might include feature engineering, outlier removal, imputation, feature selection, and the assignment of testing partition labels. As with the integration step, the output of the integration step should be a two-by-two tibble object saved as a version-controlled feather file in the <code>data_working/</code> directory for downstream use.</li>
<li><code>3_model.R</code> should read the training partitions from the enriched dataset stored in the <code>data_working/</code> directory and train the desired model(s). Model objects generated within the model.R file should be stored in the <code>models/</code> directory using consistent version control and naming conventions.</li>
<li><code>4_evaluate.R</code> should read the testing partitions from the enriched dataset stored in the <code>data_working/</code> directory and apply the trained model from the <code>model/</code> directory. Model results are appended to the testing dataset and are persisted as a .csv file in the <code>data_output/</code> directory. A feather file is not generated in this step as this data may be shared with non-technical stakeholders directly. Visualizations related to performance on the testing dataset, such as ROC Curves and box-plots, and model metadata (e.g. coefficients) may be generated at this phase and persisted in the <code>data_working/</code> directory.</li>
<li><code>5_present.Rmd</code> is an RMarkdown document template that demonstrates the assembly of data and charts stored within the <code>data_output/</code> directory.<br />
</li>
<li><code>explore.R</code> exists outside of the sequential work-flow and is used primarily for transient data analysis needed for data integration and feature preparation.</li>
<li><code>api.R</code> is a RESTful api template generated by ‘archetyper’. The API can be tested locally or deployed to an internal server. Note that the <code>&#39;archetyper&#39;</code> API template does not enforce authentication and authorization and therefore developers should consult with their security team prior to deploying an API within their organization. The RESTful service in the <code>api.R</code> file is implemented using the ‘plumber’ package.</li>
</ul>
<p>Additional files are created to serve supporting functions:</p>
<ul>
<li><code>test.R</code> stores unit and integration tests with an example unit test (using the ‘testthat’ package).</li>
<li><code>mediator.R</code> is responsible for the contiguous execution of each component, with conditions to stop execution upon failure at any step. The <code>mediator.R</code> file is named after the Gang of Four mediator pattern as it orchestrates calls to each component and enforces isolation between those components. The mediator.R file further executes unit tests prior to the execution of the work-flow. In the final step, the present.Rmd file will be executed with its output (a PDF document for example) stored into the <code>docs/</code> directory.</li>
<li><code>common.R</code> is responsible for identifying libraries common across components (e.g. ‘dplyr’, ‘stringr’, ‘magittr’, etc.), storing project constants, inheriting utilities, and initializing a centralized logger. Each component in the work-flow sources the common.R file.</li>
<li><code>utilities.R</code> is designed to store functions that are necessary across components. The <code>common.R</code> file sources the utilities.R file, and in turn, each file in the work-flow sourcing common.R also has access to the common utility methods.</li>
<li><code>.gitignore</code> ignores files that should not be stored in version control, including <code>config.yml</code>. The base .gitignore file included in the ‘archetyper’ template was generated from the gitignore r package.</li>
<li><code>lint.R</code> includes linting commands for each file in the work-flow to enforce proper style and syntax conventions.</li>
<li><code>readme.md</code> is designed to provide project documentation and details on how the user will interact with the code.</li>
<li><code>.Rproj</code> is a file indicating that the directory includes an R project and includes metadata related to the project itself. This file further serves as the marker of the root directory so that relative directories can be used in the project’s .R files. Relative directories are supported by the ‘here’ package.</li>
</ul>
<p>A directory structure designed to logically separate the data artifacts produced throughout the work-flow is also generated by the ‘archetyper’ package. These directories include:</p>
<ul>
<li><code>data_input/</code> is used to store unprocessed data read in through the <code>integration.R</code> file</li>
<li><code>data_working/</code> stores working data throughout the data mining workflow. This data includes versioned snapshots of both integrated and enriched data as well as other files and objects that might be necessary to present findings from the model.</li>
<li><code>models/</code> stores version-controlled model objects.</li>
<li><code>data_output/</code> stores version-controlled plain-text files with the appended model results.</li>
<li><code>docs/</code> stores the output of R Markdown files (and other documents resulting from the analysis)</li>
</ul>
<p>For traceability, files and objects (e.g. models) throughout the project are named according to a standard naming convention.</p>
<p><code>[ project_name ]_[ file_name ]_[ YYYY_MM_DD_HH:MM ].[ file_extension ]</code></p>
<p>This structure, in conjunction with the persistent state of each component, allows each component script to be run independently without sourcing all the preceding components.</p>
<div id="database-connections" class="section level3">
<h3>Database connections</h3>
<p>A database connection type of “odbc” or “jdbc” can be passed in as a function argument to generate scaffolding helpful for database connections.</p>
<p><strong>ODBC</strong></p>
<p>A db_connection argument of ‘odbc’ will generate a connection code snippet in the integrate.R file.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">library</span>(odbc)</span>
<span id="cb4-2"><a href="#cb4-2"></a>con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(odbc<span class="op">::</span><span class="kw">odbc</span>(), <span class="st">&quot;dev_database&quot;</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>sql &lt;-<span class="st"> &quot;select my_value from my_table&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>result_df &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con, sql)</span></code></pre></div>
<p>A file to store the database DML and DDL (for data preparation occurring in the database prior to the integration step) is additionally generated when using ‘odbc’:</p>
<ul>
<li><code>dml_ddl.sql</code> stores SQL statements and other database scripts used to prepare and extract data from the source systems.</li>
</ul>
<p>Note that when using odbc, the user must update the appropriate odbc configuration files (e.g. odbcinst.ini, odbc.ini)</p>
<p><strong>JDBC</strong></p>
<p>The following files and directories will be created with a ‘jdbc’ argument:</p>
<ul>
<li><code>dml_ddl.sql</code> stores SQL statements and other database scripts used to prepare and extract data from the source systems.</li>
<li><code>config.yml</code> stores secret information, such as user database credentials.</li>
<li><code>drivers/</code> is directory for storing database driver jars. Note that the user must provide the jars and classpath names to the jars specific to the database type being accessed.</li>
</ul>
<p>A db_connection argument of ‘jdbc’ will additionally generate a connection code snippet in the integrate.R file. Note that the credentials are sourced from the config.yml file so that they are not exposed in the source code. The config.yml file is ignored in the .gitignore file so that it is not committed to source.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">library</span>(RJDBC)</span>
<span id="cb5-2"><a href="#cb5-2"></a>db_credentials &lt;-<span class="st"> </span>config<span class="op">::</span><span class="kw">get</span>(<span class="st">&quot;dev_database&quot;</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a>drv &lt;-<span class="st"> </span>RJDBC<span class="op">::</span><span class="kw">JDBC</span>(<span class="dt">driverClass =</span> db_credentials<span class="op">$</span>driver_class, <span class="dt">classPath =</span>  <span class="kw">Sys.glob</span>(<span class="st">&quot;drivers/*&quot;</span>))</span>
<span id="cb5-4"><a href="#cb5-4"></a>con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(drv,db_credentials<span class="op">$</span>connection_string, db_credentials<span class="op">$</span>username, db_credentials<span class="op">$</span>password)</span>
<span id="cb5-5"><a href="#cb5-5"></a>sql &lt;-<span class="st"> &quot;select my_value from my_table&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>result_df &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con, sql)</span></code></pre></div>
<p>When using a JDBC connection, the user must provide appropriate driver JARs in the drivers/ directory, as well as user credentials, class path, and connection string in the config.yml file.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">generate</span>(<span class="st">&quot;majestic_12&quot;</span>, <span class="dt">db_connection_type =</span> <span class="st">&#39;jdbc&#39;</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">list.files</span>(project_path)</span>
<span id="cb6-3"><a href="#cb6-3"></a></span>
<span id="cb6-4"><a href="#cb6-4"></a> [<span class="dv">1</span>] <span class="st">&quot;config.yml&quot;</span>        <span class="st">&quot;data_input&quot;</span>        <span class="st">&quot;data_output&quot;</span>      </span>
<span id="cb6-5"><a href="#cb6-5"></a> [<span class="dv">4</span>] <span class="st">&quot;data_working&quot;</span>      <span class="st">&quot;docs&quot;</span>              <span class="st">&quot;drivers&quot;</span>          </span>
<span id="cb6-6"><a href="#cb6-6"></a> [<span class="dv">7</span>] <span class="st">&quot;majestic_12.Rproj&quot;</span> <span class="st">&quot;models&quot;</span>            <span class="st">&quot;R&quot;</span>                </span>
<span id="cb6-7"><a href="#cb6-7"></a>[<span class="dv">10</span>] <span class="st">&quot;readme.md&quot;</span>         <span class="st">&quot;.gitignore&quot;</span>        <span class="st">&quot;dml_ddl.sql&quot;</span></span></code></pre></div>
</div>
<div id="excluding-components" class="section level3">
<h3>Excluding components</h3>
<p>The <code>exclude</code> argument prevents specified files from being generated.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">generate</span>(<span class="dt">project_name =</span> project_name, <span class="dt">path =</span> project_directory, <span class="dt">exclude =</span> <span class="kw">c</span>(<span class="st">&quot;api.R&quot;</span>, <span class="st">&quot;utilities.R&quot;</span>, <span class="st">&quot;readme.md&quot;</span>, <span class="st">&quot;lint.R&quot;</span>, <span class="st">&quot;.gitignore&quot;</span>))</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">list.files</span>(project_path)</span>
<span id="cb7-4"><a href="#cb7-4"></a>[<span class="dv">1</span>] <span class="st">&quot;data_input&quot;</span>        <span class="st">&quot;data_output&quot;</span>       <span class="st">&quot;data_working&quot;</span>      <span class="st">&quot;docs&quot;</span>              <span class="st">&quot;majestic_12.Rproj&quot;</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>[<span class="dv">6</span>] <span class="st">&quot;models&quot;</span>            <span class="st">&quot;R&quot;</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="kw">list.files</span>(project_path_r)</span>
<span id="cb7-7"><a href="#cb7-7"></a> [<span class="dv">1</span>] <span class="st">&quot;0_test.R&quot;</span>      <span class="st">&quot;1_integrate.R&quot;</span> <span class="st">&quot;2_enrich.R&quot;</span>    <span class="st">&quot;3_model.R&quot;</span>     <span class="st">&quot;4_evaluate.R&quot;</span>  <span class="st">&quot;5_present.Rmd&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8"></a> [<span class="dv">7</span>] <span class="st">&quot;common.R&quot;</span>      <span class="st">&quot;explore.R&quot;</span>     <span class="st">&quot;mediator.R&quot;</span></span></code></pre></div>
</div>
</div>
<div id="generating-the-demo-project" class="section level2">
<h2>Generating the demo project</h2>
<p>The ‘archetyper’ project is pre-packaged with a working demo project that predicts hospital readmission rates based on publicly-available structural characteristics and complication rates.</p>
<p>The demo project can be generated by running the generate_demo() function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>archetyper<span class="op">::</span><span class="kw">generate_demo</span>()</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">list.files</span>(<span class="st">&quot;hospital_readmissions_demo/&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a>[<span class="dv">1</span>] <span class="st">&quot;data_input&quot;</span>        <span class="st">&quot;data_output&quot;</span>       <span class="st">&quot;data_working&quot;</span>      <span class="st">&quot;docs&quot;</span>              <span class="st">&quot;hospital_readmissions_demo.Rproj&quot;</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>[<span class="dv">6</span>] <span class="st">&quot;models&quot;</span>            <span class="st">&quot;R&quot;</span>                 <span class="st">&quot;readme.md&quot;</span>        <span class="st">&quot;.gitignore&quot;</span></span></code></pre></div>
<p>Once the demo project has been created, the project should be opened in RStudio.</p>
<div id="running-the-demo-workflow" class="section level3">
<h3>Running the demo workflow</h3>
<p>The the full data-mining/data-science life-cycle can be triggered by executing the <code>mediator.R</code> file. The contents of the <code>mediator.R</code> file is below:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">cat</span>(<span class="kw">readChar</span>(<span class="st">&quot;hospital_readmissions_demo/R/mediator.R&quot;</span>), <span class="fl">1e5</span>)<span class="er">)</span></span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co">##--------------------------------------------------------------------------</span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">##  The mediator file will execute the linear data processing work-flow.   -</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">##--------------------------------------------------------------------------</span></span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="kw">source</span>(<span class="st">&quot;R/common.R&quot;</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="kw">tryCatch</span>({</span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="kw">info</span>(logger, <span class="st">&quot;running tests...&quot;</span>)</span>
<span id="cb9-10"><a href="#cb9-10"></a>    <span class="kw">source</span>(<span class="st">&quot;R/0_test.R&quot;</span>)</span>
<span id="cb9-11"><a href="#cb9-11"></a>    <span class="kw">info</span>(logger, <span class="st">&quot;gathering and integrating data...&quot;</span>)</span>
<span id="cb9-12"><a href="#cb9-12"></a>    <span class="kw">source</span>(<span class="st">&quot;R/1_integrate.R&quot;</span>)</span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="kw">info</span>(logger, <span class="st">&quot;enriching base data...&quot;</span>)</span>
<span id="cb9-14"><a href="#cb9-14"></a>    <span class="kw">source</span>(<span class="st">&quot;R/2_enrich.R&quot;</span>)</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="kw">info</span>(logger, <span class="st">&quot;building model(s)...&quot;</span>)</span>
<span id="cb9-16"><a href="#cb9-16"></a>    <span class="kw">source</span>(<span class="st">&quot;R/3_model.R&quot;</span>)</span>
<span id="cb9-17"><a href="#cb9-17"></a>    <span class="kw">info</span>(logger, <span class="st">&quot;applying model(s) to test partitions...&quot;</span>)</span>
<span id="cb9-18"><a href="#cb9-18"></a>    <span class="kw">source</span>(<span class="st">&quot;R/4_evaluate.R&quot;</span>)</span>
<span id="cb9-19"><a href="#cb9-19"></a>    <span class="kw">info</span>(logger, <span class="st">&quot;building presentation materials...&quot;</span>)</span>
<span id="cb9-20"><a href="#cb9-20"></a>    rmarkdown<span class="op">::</span><span class="kw">render</span>(<span class="st">&quot;R/5_present.Rmd&quot;</span>, <span class="st">&quot;pdf_document&quot;</span>, <span class="dt">output_dir =</span> <span class="st">&quot;docs&quot;</span>)</span>
<span id="cb9-21"><a href="#cb9-21"></a>    <span class="kw">info</span>(logger, <span class="st">&quot;workflow is complete.&quot;</span>)</span>
<span id="cb9-22"><a href="#cb9-22"></a></span>
<span id="cb9-23"><a href="#cb9-23"></a>  },</span>
<span id="cb9-24"><a href="#cb9-24"></a>  <span class="dt">error =</span> <span class="cf">function</span>(cond) {</span>
<span id="cb9-25"><a href="#cb9-25"></a>    log4r<span class="op">::</span><span class="kw">error</span>(logger, <span class="kw">str_c</span>(<span class="st">&quot;Script error: &quot;</span>, cond))</span>
<span id="cb9-26"><a href="#cb9-26"></a>  }</span>
<span id="cb9-27"><a href="#cb9-27"></a>)</span></code></pre></div>
<p>Note that the file includes a centralized logger to distinguish levels of severity (using the ‘log4r’ package) as well as relative directory references (using the ‘here’ package). Comments in all files were created using the ‘bannerCommenter’ package.</p>
</div>
<div id="integration" class="section level3">
<h3>Integration</h3>
<p>A set of publicly-available data files will be loaded by the integration.R file. The integration step joins and transforms the source files according to Tidy Data principles, and persists the integrated data into the data_working/ directory.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data_working/&quot;</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a>[<span class="dv">1</span>] <span class="st">&quot;hospital_readmissions_integrated_2021-02-25.feather&quot;</span>    </span></code></pre></div>
</div>
<div id="enrichment" class="section level3">
<h3>Enrichment</h3>
<p>The enrichment step creates features better suited for the modeling process by applying feature engineering methods (such as scaling and centering the numeric features), outlier removal (using Cook’s Distance), imputation (using predictive mean matching PMM), and feature selection (by removing highly-correlated features). Additionally, training labels are assigned through stratified random sampling. The enriched results are stored in feather format in the data_working/ directory.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data_working/&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>[<span class="dv">1</span>] <span class="st">&quot;hospital_readmissions_enriched_2021-02-25.feather&quot;</span>       <span class="st">&quot;hospital_readmissions_integrated_2021-02-25.feather&quot;</span> </span></code></pre></div>
</div>
<div id="modeling" class="section level3">
<h3>Modeling</h3>
<p>In the modeling step, a stepwise linear regression is applied to the training partition of the enriched dataset. The model coefficients, performance statistics, and the model itself is stored in the data_output/ and models/ directories (respectively).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data_ouput/&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a>[<span class="dv">1</span>] <span class="st">&quot;hospital_readmissions_feature_dtl_2021-02-25.csv&quot;</span>   <span class="st">&quot;hospital_readmissions_perf_2021-02-25.csv&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;mod/&quot;</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>[<span class="dv">1</span>] <span class="st">&quot;hospital_readmissions_readmissions_2021-02-23.mod&quot;</span></span></code></pre></div>
</div>
<div id="evaluation" class="section level3">
<h3>Evaluation</h3>
<p>In the evaluation step, the testing partitions of the enriched dataset are applied to the trained model from the models/ directory. The testing data with the appended predictions, along with performance statistics from the testing dataset, are stored in the data_output/ directory as a .csv file.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;data_ouput/&quot;</span>)</span>
<span id="cb13-2"><a href="#cb13-2"></a>[<span class="dv">1</span>] <span class="st">&quot;hospital_readmissions_feature_dtl_2021-02-25.csv&quot;</span>   <span class="st">&quot;hospital_readmissions_holdout_perf_stats_2021-02-25.csv&quot;</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>[<span class="dv">3</span>] <span class="st">&quot;hospital_readmissions_perf_2021-02-25.csv&quot;</span>    <span class="st">&quot;hospital_readmissions_testing_w_predictions_2021-02-25.csv&quot;</span></span></code></pre></div>
</div>
<div id="presentation" class="section level3">
<h3>Presentation</h3>
<p>Finally, an R Markdown report is produced, using files sourced from the data_output/ directory.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">#Present</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="op">&gt;</span><span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;hospital_readmissions_demo/docs/&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3"></a>[<span class="dv">1</span>] <span class="st">&quot;5_present.pdf&quot;</span></span></code></pre></div>
</div>
<div id="deployment" class="section level3">
<h3>Deployment</h3>
<p>The api.R file generates a sample RESTful api that uses the trained model from the models/ directory. The demo api can be called with the below sample request body:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>{</span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="st">&quot;dt&quot;</span><span class="op">:</span><span class="st"> </span>{<span class="st">&quot;state&quot;</span><span class="op">:</span><span class="st"> &quot;AL&quot;</span>,</span>
<span id="cb15-3"><a href="#cb15-3"></a>    <span class="st">&quot;hospital_type&quot;</span><span class="op">:</span><span class="st"> &quot;acute_care_hospitals&quot;</span>,</span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="st">&quot;hospital_ownership&quot;</span><span class="op">:</span><span class="st"> &quot;government_hospital_district_or_authority&quot;</span>,</span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="st">&quot;emergency_services&quot;</span><span class="op">:</span><span class="st"> &quot;Yes&quot;</span>,</span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="st">&quot;ehr_interop&quot;</span><span class="op">:</span><span class="st"> &quot;Y&quot;</span>,</span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="st">&quot;denominator&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">1.4791</span>,</span>
<span id="cb15-8"><a href="#cb15-8"></a>    <span class="st">&quot;PSI_10&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">-1.3895</span>,</span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="st">&quot;PSI_11&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">0.597</span>,</span>
<span id="cb15-10"><a href="#cb15-10"></a>    <span class="st">&quot;PSI_12&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">-0.9487</span>,</span>
<span id="cb15-11"><a href="#cb15-11"></a>    <span class="st">&quot;PSI_13&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">-0.102</span>,</span>
<span id="cb15-12"><a href="#cb15-12"></a>    <span class="st">&quot;PSI_14&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">-1.1131</span>,</span>
<span id="cb15-13"><a href="#cb15-13"></a>    <span class="st">&quot;PSI_15&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">-0.9439</span>,</span>
<span id="cb15-14"><a href="#cb15-14"></a>    <span class="st">&quot;PSI_3&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">0.029</span>,</span>
<span id="cb15-15"><a href="#cb15-15"></a>    <span class="st">&quot;PSI_6&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">-0.5752</span>,</span>
<span id="cb15-16"><a href="#cb15-16"></a>    <span class="st">&quot;PSI_8&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">-1.4081</span>,</span>
<span id="cb15-17"><a href="#cb15-17"></a>    <span class="st">&quot;PSI_9&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">-0.3028</span>,</span>
<span id="cb15-18"><a href="#cb15-18"></a>    <span class="st">&quot;denominator_ln&quot;</span><span class="op">:</span><span class="st"> </span><span class="fl">1.3489</span>}</span>
<span id="cb15-19"><a href="#cb15-19"></a>}</span></code></pre></div>
<p>Note that the demo project was designed simply to illustrate the the functionality of the ‘archetyper’ project. It was not designed to be a production or publish worthy model.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
